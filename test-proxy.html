<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Proxy WooCommerce</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #0070f3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0051cc;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        pre {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin-top: 20px;
            border: 1px solid #e0e0e0;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test Proxy WooCommerce</h1>
        <p>Ce test v√©rifie si le proxy Vercel fonctionne correctement.</p>
        
        <div>
            <button onclick="testProxy()">1. Tester le proxy</button>
            <button onclick="testDirectAPI()">2. Tester l'API directe</button>
            <button onclick="clearResults()">Effacer</button>
        </div>
        
        <div id="status"></div>
        <pre id="result"></pre>
    </div>
    
    <script>
        const proxyUrl = 'https://intexo.vercel.app/api/woocommerce/products';
        const directApiUrl = 'https://www.impexo.fr/wp-json/wc/v3/products';
        
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function showResult(data) {
            const resultEl = document.getElementById('result');
            resultEl.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
        }
        
        function clearResults() {
            document.getElementById('status').innerHTML = '';
            document.getElementById('result').textContent = '';
        }
        
        async function testProxy() {
            showStatus('‚è≥ Test du proxy en cours...', 'info');
            showResult('Chargement...');
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${proxyUrl}?per_page=1`);
                const duration = Date.now() - startTime;
                
                const contentType = response.headers.get('content-type') || '';
                const isJson = contentType.includes('application/json');
                
                let data;
                if (isJson) {
                    data = await response.json();
                } else {
                    const text = await response.text();
                    data = {
                        error: 'R√©ponse non-JSON',
                        contentType,
                        preview: text.substring(0, 500),
                        isHtml: text.includes('<!doctype') || text.includes('<html')
                    };
                }
                
                if (response.ok && Array.isArray(data)) {
                    showStatus(`‚úÖ Proxy fonctionne ! (${duration}ms) - ${data.length} produit(s) trouv√©(s)`, 'success');
                    showResult({
                        status: response.status,
                        duration: `${duration}ms`,
                        productsFound: data.length,
                        contentType,
                        firstProduct: data[0] || null
                    });
                } else if (response.ok && data.error) {
                    showStatus(`‚ö†Ô∏è Proxy r√©pond mais avec une erreur`, 'error');
                    showResult(data);
                } else {
                    showStatus(`‚ùå Erreur ${response.status}`, 'error');
                    showResult({
                        status: response.status,
                        statusText: response.statusText,
                        contentType,
                        data
                    });
                }
            } catch (error) {
                showStatus(`‚ùå Erreur r√©seau: ${error.message}`, 'error');
                showResult({
                    error: error.message,
                    type: error.name,
                    stack: error.stack
                });
            }
        }
        
        async function testDirectAPI() {
            showStatus('‚è≥ Test de l\'API directe en cours...', 'info');
            showResult('Chargement...');
            
            // ‚ö†Ô∏è ATTENTION : Les cl√©s API sont expos√©es ici (pour test uniquement)
            const consumerKey = 'ck_374c0ec78039fd4115f44238dae84ac7cb31cd38';
            const consumerSecret = 'cs_80d24956f94f48b7724d06bc5149e7ab0cf376a3';
            
            try {
                const startTime = Date.now();
                const url = `${directApiUrl}?consumer_key=${consumerKey}&consumer_secret=${consumerSecret}&per_page=1&status=publish`;
                const response = await fetch(url);
                const duration = Date.now() - startTime;
                
                const contentType = response.headers.get('content-type') || '';
                const isJson = contentType.includes('application/json');
                
                let data;
                if (isJson) {
                    data = await response.json();
                } else {
                    const text = await response.text();
                    data = {
                        error: 'R√©ponse non-JSON',
                        contentType,
                        preview: text.substring(0, 500)
                    };
                }
                
                if (response.ok && Array.isArray(data)) {
                    showStatus(`‚úÖ API directe fonctionne ! (${duration}ms) - ${data.length} produit(s) trouv√©(s)`, 'success');
                    showResult({
                        status: response.status,
                        duration: `${duration}ms`,
                        productsFound: data.length,
                        contentType,
                        firstProduct: data[0] || null
                    });
                } else {
                    showStatus(`‚ùå Erreur ${response.status}`, 'error');
                    showResult({
                        status: response.status,
                        statusText: response.statusText,
                        contentType,
                        data
                    });
                }
            } catch (error) {
                showStatus(`‚ùå Erreur r√©seau: ${error.message}`, 'error');
                showResult({
                    error: error.message,
                    type: error.name
                });
            }
        }
    </script>
</body>
</html>
